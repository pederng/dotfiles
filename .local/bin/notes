#! /bin/bash

ndir=${NOTES_DIR-$HOME/.notes}
cmd=$1
shift

function downsync_notes() {
  git --git-dir="$ndir"/.git --work-tree="$ndir" pull
}

function upsync_notes() {
  git --git-dir="$ndir"/.git --work-tree="$ndir"  add .
  git --git-dir="$ndir"/.git --work-tree="$ndir"  commit --author="Autocommiter <>" -m "Autocommit"
  git --git-dir="$ndir"/.git --work-tree="$ndir"  push
}

find_md() {
  find "$ndir" -iname '*.md' | awk -F / '{print $NF}'
}


if [ "$cmd" = "" ]; then
  notes "$(find_md | fzf --preview='cat {}')"
else
  case $cmd in
    list)
      find_md
    ;;

    *)
      downsync_notes
      vim "$ndir/$cmd"
      upsync_notes
    ;;
  esac
fi
